<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2563eb">
    <title><%= title %></title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos consistentes con la página principal */
        .safe-area-padding {
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .btn-touch {
            min-height: 44px;
            min-width: 44px;
        }
        
        .no-select {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* Card hover effects */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* File type icons */
        .file-icon-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* Animación de entrada para tarjetas */
        .card-enter {
            opacity: 0;
            animation: slideIn 0.5s ease-out forwards;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Toast notification */
        .toast-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #2563eb, #dc2626);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #1d4ed8, #b91c1c);
        }
        
        /* Image overlay */
        .image-overlay {
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0) 100%);
        }
        
        /* Badge styles */
        .badge {
            backdrop-filter: blur(4px);
            background: rgba(255, 255, 255, 0.9);
        }
        
        /* Grid optimizado */
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-red-50 min-h-screen safe-area-padding">
    <div class="container mx-auto px-4 py-8 md:py-12 max-w-7xl">
        <!-- Header mejorado con glassmorphism -->
        <div class="text-center mb-12 fade-in">
            <div class="relative inline-block">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-600 to-red-600 rounded-full blur-3xl opacity-20"></div>
                <div class="relative bg-white bg-opacity-90 backdrop-blur-sm px-8 py-6 rounded-2xl shadow-lg border border-gray-100">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3">
                        <span class="bg-gradient-to-r from-blue-600 to-red-600 bg-clip-text text-transparent">
                            <i class="fas fa-cloud mr-3 text-blue-600"></i>
                            Mis Archivos
                        </span>
                    </h1>
                    <p class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
                        Administra tus archivos subidos a Cloudinary
                    </p>
                </div>
            </div>
            
            <!-- Navigation mejorada -->
            <div class="mt-8 flex flex-wrap justify-center gap-4">
                <a href="/" class="group bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-8 py-3.5 rounded-xl transition-all duration-300 font-semibold btn-touch no-select shadow-lg shadow-blue-500/25 hover:shadow-xl hover:shadow-blue-500/30 inline-flex items-center">
                    <i class="fas fa-arrow-left mr-2 group-hover:scale-110 transition-transform"></i>
                    Generador QR
                </a>
                <button onclick="window.location.reload()" class="group bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white px-8 py-3.5 rounded-xl transition-all duration-300 font-semibold btn-touch no-select shadow-lg shadow-gray-500/25 hover:shadow-xl hover:shadow-gray-500/30 inline-flex items-center">
                    <i class="fas fa-sync-alt mr-2 group-hover:rotate-180 transition-transform duration-500"></i>
                    Actualizar
                </button>
            </div>
        </div>

        <!-- Stats Cards - Solo visible si hay archivos -->
        <% if (files.length > 0) { %>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10 fade-in" style="animation-delay: 0.1s;">
            <div class="bg-white/90 backdrop-blur-sm rounded-xl shadow-lg border border-gray-100 p-4 card-hover">
                <div class="flex items-center">
                    <div class="bg-gradient-to-br from-blue-100 to-blue-200 p-3 rounded-lg">
                        <i class="fas fa-cloud-upload-alt text-2xl text-blue-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Total archivos</p>
                        <p class="text-2xl font-bold text-gray-800"><%= files.length %></p>
                    </div>
                </div>
            </div>
            
            <% 
            const imageCount = files.filter(f => f.type.includes('image')).length;
            const videoCount = files.filter(f => f.type.includes('video')).length;
            const docCount = files.length - imageCount - videoCount;
            %>
            
            <div class="bg-white/90 backdrop-blur-sm rounded-xl shadow-lg border border-gray-100 p-4 card-hover">
                <div class="flex items-center">
                    <div class="bg-gradient-to-br from-green-100 to-green-200 p-3 rounded-lg">
                        <i class="fas fa-image text-2xl text-green-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Imágenes</p>
                        <p class="text-2xl font-bold text-gray-800"><%= imageCount %></p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white/90 backdrop-blur-sm rounded-xl shadow-lg border border-gray-100 p-4 card-hover">
                <div class="flex items-center">
                    <div class="bg-gradient-to-br from-purple-100 to-purple-200 p-3 rounded-lg">
                        <i class="fas fa-video text-2xl text-purple-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Videos</p>
                        <p class="text-2xl font-bold text-gray-800"><%= videoCount %></p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white/90 backdrop-blur-sm rounded-xl shadow-lg border border-gray-100 p-4 card-hover">
                <div class="flex items-center">
                    <div class="bg-gradient-to-br from-red-100 to-red-200 p-3 rounded-lg">
                        <i class="fas fa-file-pdf text-2xl text-red-600"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Documentos</p>
                        <p class="text-2xl font-bold text-gray-800"><%= docCount %></p>
                    </div>
                </div>
            </div>
        </div>
        <% } %>

        <!-- Files Grid -->
        <div class="max-w-7xl mx-auto">
            <% if (files.length > 0) { %>
                <!-- Barra de búsqueda y filtros -->
                <div class="mb-8 flex flex-col sm:flex-row justify-between items-center gap-4 fade-in" style="animation-delay: 0.15s;">
                    <div class="relative w-full sm:w-96">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input 
                            type="text" 
                            id="searchInput"
                            placeholder="Buscar archivos..." 
                            class="w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all duration-200 bg-white/90 backdrop-blur-sm"
                            onkeyup="filterFiles()"
                        >
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="filterByType('all')" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-colors">
                            Todos
                        </button>
                        <button onclick="filterByType('image')" class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-sm font-medium transition-colors">
                            <i class="fas fa-image mr-1"></i>Imágenes
                        </button>
                        <button onclick="filterByType('video')" class="px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg text-sm font-medium transition-colors">
                            <i class="fas fa-video mr-1"></i>Videos
                        </button>
                    </div>
                </div>

                <!-- Grid de archivos mejorado -->
                <div id="filesGrid" class="files-grid">
                    <% files.forEach((file, index) => { %>
                        <div class="file-card bg-white/90 backdrop-blur-sm rounded-xl shadow-lg border border-gray-100 overflow-hidden card-hover card-enter flex flex-col h-full" 
                             style="animation-delay: <%= 0.2 + (index * 0.05) %>s;"
                             data-type="<%= file.type %>"
                             data-name="<%= file.publicId.toLowerCase() %>">
                            
                            <!-- Cabecera con imagen o icono -->
                            <div class="relative h-48 bg-gradient-to-br from-gray-100 to-gray-200">
                                <% if (file.thumbnail) { %>
                                    <img src="<%= file.thumbnail %>" alt="<%= file.publicId %>" class="w-full h-full object-cover">
                                    <div class="absolute inset-0 image-overlay opacity-0 hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                        <span class="bg-white text-gray-800 px-4 py-2 rounded-lg font-medium shadow-lg">
                                            <i class="fas fa-eye mr-2"></i>Ver archivo
                                        </span>
                                    </div>
                                <% } else { %>
                                    <div class="w-full h-full flex items-center justify-center">
                                        <% if (file.type.includes('image')) { %>
                                            <div class="bg-gradient-to-br from-blue-100 to-blue-200 p-6 rounded-full">
                                                <i class="fas fa-file-image text-5xl text-blue-600"></i>
                                            </div>
                                        <% } else if (file.type.includes('video')) { %>
                                            <div class="bg-gradient-to-br from-purple-100 to-purple-200 p-6 rounded-full">
                                                <i class="fas fa-file-video text-5xl text-purple-600"></i>
                                            </div>
                                        <% } else if (file.format.includes('pdf')) { %>
                                            <div class="bg-gradient-to-br from-red-100 to-red-200 p-6 rounded-full">
                                                <i class="fas fa-file-pdf text-5xl text-red-600"></i>
                                            </div>
                                        <% } else { %>
                                            <div class="bg-gradient-to-br from-gray-100 to-gray-300 p-6 rounded-full">
                                                <i class="fas fa-file-alt text-5xl text-gray-600"></i>
                                            </div>
                                        <% } %>
                                    </div>
                                <% } %>
                                
                                <!-- Badge de tipo de archivo -->
                                <div class="absolute top-3 right-3">
                                    <span class="badge px-3 py-1.5 rounded-full text-xs font-semibold shadow-md flex items-center">
                                        <i class="fas fa-tag mr-1"></i>
                                        <%= file.format.toUpperCase() %>
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Contenido de la tarjeta -->
                            <div class="p-5 flex-1 flex flex-col">
                                <div class="flex-1">
                                    <h3 class="font-bold text-gray-800 text-lg mb-3 line-clamp-2">
                                        <%= file.publicId.length > 30 ? file.publicId.substring(0, 30) + '...' : file.publicId %>
                                    </h3>
                                    
                                    <div class="space-y-2.5 text-sm">
                                        <div class="flex items-center text-gray-600">
                                            <div class="w-8">
                                                <i class="fas fa-weight-hanging text-gray-400"></i>
                                            </div>
                                            <span class="font-medium"><%= file.size %></span>
                                        </div>
                                        <div class="flex items-center text-gray-600">
                                            <div class="w-8">
                                                <i class="fas fa-calendar-alt text-gray-400"></i>
                                            </div>
                                            <span><%= new Date(file.createdAt).toLocaleDateString('es-ES', { 
                                                year: 'numeric', 
                                                month: 'short', 
                                                day: 'numeric' 
                                            }) %></span>
                                        </div>
                                        <div class="flex items-center text-gray-600">
                                            <div class="w-8">
                                                <i class="fas fa-cloud text-gray-400"></i>
                                            </div>
                                            <span class="truncate text-xs">Cloudinary</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Acciones -->
                                <div class="mt-5 pt-4 border-t border-gray-100 grid grid-cols-2 gap-2">
                                    <a href="<%= file.url %>" target="_blank" 
                                       class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-medium py-2.5 px-3 rounded-lg transition-all duration-200 text-sm text-center inline-flex items-center justify-center shadow-md hover:shadow-lg">
                                        <i class="fas fa-external-link-alt mr-2"></i>
                                        Abrir
                                    </a>
                                    <button onclick="copyUrl('<%= file.url %>', this)" 
                                            class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-medium py-2.5 px-3 rounded-lg transition-all duration-200 text-sm inline-flex items-center justify-center shadow-md hover:shadow-lg">
                                        <i class="fas fa-copy mr-2"></i>
                                        Copiar
                                    </button>
                                </div>
                                
                                <!-- QR Action -->
                                <div class="mt-2">
                                    <button onclick="generateQR('<%= file.url %>')" 
                                            class="w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-medium py-2.5 px-3 rounded-lg transition-all duration-200 text-sm inline-flex items-center justify-center">
                                        <i class="fas fa-qrcode mr-2"></i>
                                        Generar QR
                                    </button>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
                
                <!-- Contador de archivos -->
                <div class="mt-8 text-center text-gray-600 text-sm">
                    <span id="fileCount">Mostrando <%= files.length %></span> archivos
                </div>
                
            <% } else { %>
                <!-- Empty State mejorado -->
                <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-gray-100 p-12 text-center fade-in max-w-2xl mx-auto">
                    <div class="bg-gradient-to-br from-gray-100 to-gray-200 rounded-full w-32 h-32 flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-cloud-upload-alt text-5xl text-gray-500"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">No hay archivos aún</h3>
                    <p class="text-gray-600 mb-8 text-lg">
                        Comienza subiendo tu primer archivo a Cloudinary
                    </p>
                    <a href="/" 
                       class="inline-flex items-center bg-gradient-to-r from-blue-600 to-red-600 hover:from-blue-700 hover:to-red-700 text-white font-semibold py-4 px-8 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl btn-touch no-select">
                        <i class="fas fa-upload mr-2"></i>
                        Subir primer archivo
                        <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                    
                    <!-- Características -->
                    <div class="mt-12 grid grid-cols-3 gap-4 text-center">
                        <div>
                            <div class="bg-blue-100 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-shield-alt text-blue-600"></i>
                            </div>
                            <p class="text-xs text-gray-600">Almacenamiento seguro</p>
                        </div>
                        <div>
                            <div class="bg-red-100 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-bolt text-red-600"></i>
                            </div>
                            <p class="text-xs text-gray-600">Acceso rápido</p>
                        </div>
                        <div>
                            <div class="bg-green-100 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-qrcode text-green-600"></i>
                            </div>
                            <p class="text-xs text-gray-600">QR instantáneo</p>
                        </div>
                    </div>
                </div>
            <% } %>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast-notification bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-4 rounded-xl shadow-2xl hidden items-center gap-3 z-50">
        <i class="fas fa-check-circle text-2xl"></i>
        <div>
            <p id="toastMessage" class="font-semibold">URL copiada</p>
            <p id="toastSubMessage" class="text-sm text-white/80"></p>
        </div>
    </div>

    <script>
        // Función mejorada para copiar URL
        function copyUrl(url, button) {
            navigator.clipboard.writeText(url).then(() => {
                // Feedback visual en el botón
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check mr-2"></i>Copiado!';
                button.classList.remove('bg-gradient-to-r', 'from-red-600', 'to-red-700', 'hover:from-red-700', 'hover:to-red-800');
                button.classList.add('bg-gradient-to-r', 'from-green-600', 'to-green-700');
                
                // Mostrar toast
                showToast('URL copiada', 'Lista para compartir');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-gradient-to-r', 'from-green-600', 'to-green-700');
                    button.classList.add('bg-gradient-to-r', 'from-red-600', 'to-red-700', 'hover:from-red-700', 'hover:to-red-800');
                }, 2000);
            }).catch(err => {
                showToast('Error', 'No se pudo copiar', 'error');
            });
        }
        
        // Función para mostrar toast
        function showToast(message, subMessage, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastSubMessage = document.getElementById('toastSubMessage');
            
            if (type === 'success') {
                toast.className = 'toast-notification bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 z-50';
            } else {
                toast.className = 'toast-notification bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 z-50';
            }
            
            toastMessage.textContent = message;
            toastSubMessage.textContent = subMessage;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }
        
        // Función para generar QR (redirige a la página principal)
        function generateQR(url) {
            // Guardar la URL en localStorage
            localStorage.setItem('pendingQR', url);
            // Redirigir a la página principal
            window.location.href = '/';
        }
        
        // Función para filtrar archivos
        function filterFiles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.file-card');
            let visibleCount = 0;
            
            cards.forEach(card => {
                const fileName = card.dataset.name;
                if (fileName.includes(searchTerm)) {
                    card.style.display = 'flex';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            document.getElementById('fileCount').textContent = `Mostrando ${visibleCount}`;
        }
        
        // Función para filtrar por tipo
        function filterByType(type) {
            const cards = document.querySelectorAll('.file-card');
            let visibleCount = 0;
            
            cards.forEach(card => {
                if (type === 'all' || card.dataset.type.includes(type)) {
                    card.style.display = 'flex';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            document.getElementById('fileCount').textContent = `Mostrando ${visibleCount}`;
        }
        
        // Verificar si hay URL pendiente para generar QR
        document.addEventListener('DOMContentLoaded', function() {
            const pendingQR = localStorage.getItem('pendingQR');
            if (pendingQR) {
                localStorage.removeItem('pendingQR');
                // Mostrar mensaje
                showToast('URL lista para QR', 'Genera tu código en la página principal');
            }
        });
    </script>
</body>
</html>